name: Manual Portman

on:
  workflow_dispatch:

jobs:
  portman:
    uses: ./.github/workflows/portman.yml
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Publish to GH-pages
        uses: JamesIves/github-pages-deploy-action@4.1.5
        with:
          branch: gh-pages
          folder: docs
          clean: false

      - name: Notify slack success
        if: success()
        uses: slackapi/slack-github-action@v1.16.0
        with:
          channel-id: "C02PFCP98A1"
          slack-message: ":white_check_mark: API tests completed. See https://api.vcpr.org/automated-tests-vor \n  https://api.vcpr.org/automated-tests-mor \n  https://api.vcpr.org/automated-tests-saor for reports"
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      - name: Notify slack failure
        if: failure()
        uses: slackapi/slack-github-action@v1.16.0
        with:
          channel-id: "C02PFCP98A1"
          slack-message: ":red_circle: API testing FAILED for ${{github.repository}}"
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
